<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hacker News Job Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .hn-orange { background-color: #ff6600; }
        .hn-orange-text { color: #ff6600; }
        .dark .hn-orange { background-color: #dd5500; }
        .dark .hn-orange-text { color: #ff8833; }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen transition-colors duration-200">
    <div class="container mx-auto p-4 max-w-4xl">
        <!-- Header -->
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-xl font-bold">Hacker News: Who is hiring? Tracker</h1>
            <div class="flex space-x-2">
                <button id="darkModeToggle" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded text-sm">Dark Mode</button>
                <button id="exportBtn" class="px-3 py-1 bg-hn-orange text-white rounded text-sm">Export</button>
                <input type="file" id="importInput" accept=".json" class="hidden">
                <button id="importBtn" class="px-3 py-1 bg-hn-orange text-white rounded text-sm">Import</button>
            </div>
        </div>

        <!-- Controls -->
        <div class="mb-4 flex flex-col sm:flex-row justify-between items-center space-y-2 sm:space-y-0 sm:space-x-4">
            <div class="flex space-x-2 w-full sm:w-auto">
                <select id="monthSelect" class="p-2 border rounded bg-white dark:bg-gray-800 text-sm">
                    <option value="2025-04">April 2025</option>
                    <option value="2025-03">March 2025</option>
                    <!-- Dynamically populate with API data -->
                </select>
                <input id="searchInput" type="text" placeholder="Search (e.g., remote, golang)" class="p-2 border rounded w-full sm:w-64 bg-white dark:bg-gray-800 text-sm">
            </div>
            <label class="flex items-center text-sm">
                <input id="hideApplied" type="checkbox" class="mr-2">
                Hide Applied
            </label>
        </div>

        <!-- Job List -->
        <div id="jobList" class="space-y-3"></div>
    </div>

    <script>
        // Simulated Algolia HN API data (replace with real API calls)
        const mockPosts = {
            '2025-04': {
                objectID: '123456',
                title: 'Ask HN: Who is hiring? (April 2025)',
                children: [
                    { objectID: '1', author: 'companyA', text: 'Company A | Go Developer | Remote | $120k-$150k | <a href="https://companyA.com">Apply</a>' },
                    { objectID: '2', author: 'companyB', text: 'Company B | Frontend Engineer | React, NYC | $100k-$130k' },
                    { objectID: '3', author: 'companyC', text: 'Company C | Full-stack | Python, Remote | $110k-$140k' },
                ]
            },
            '2025-03': {
                objectID: '123455',
                title: 'Ask HN: Who is hiring? (March 2025)',
                children: [
                    { objectID: '4', author: 'companyD', text: 'Company D | DevOps | AWS, Remote | $130k-$160k' },
                    { objectID: '5', author: 'companyE', text: 'Company E | ML Engineer | SF | $140k-$180k' },
                ]
            }
        };

        // Real Algolia HN API fetching (uncomment in production)
        /*
        async function fetchHiringPosts() {
            const response = await fetch('https://hn.algolia.com/api/v1/search?query=from:whoishiring "Who is hiring?"&tags=ask');
            const data = await response.json();
            return data.hits.filter(post => post.title.includes('Who is hiring?'));
        }
        async function fetchComments(postId) {
            const response = await fetch(`https://hn.algolia.com/api/v1/search?tags=comment,(${postId})`);
            const data = await response.json();
            return data.hits.filter(comment => !comment._tags.includes('dead') && !comment._tags.includes('deleted'));
        }
        async function initialize() {
            const posts = await fetchHiringPosts();
            const monthSelect = document.getElementById('monthSelect');
            monthSelect.innerHTML = '';
            posts.forEach(post => {
                const date = new Date(post.created_at);
                const monthYear = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                const option = document.createElement('option');
                option.value = monthYear;
                option.textContent = post.title.replace('Ask HN: Who is hiring? ', '');
                monthSelect.appendChild(option);
            });
            if (posts.length > 0) {
                currentMonth = posts[0].created_at.slice(0, 7);
                renderJobs(currentMonth);
            }
        }
        */

        // Load data from localStorage
        let appliedJobs = JSON.parse(localStorage.getItem('hnAppliedJobs')) || {};
        let jobNotes = JSON.parse(localStorage.getItem('hnJobNotes')) || {};

        // Render jobs
        function renderJobs(month, searchTerm = '', hideApplied = false) {
            const jobList = document.getElementById('jobList');
            jobList.innerHTML = '';
            const post = mockPosts[month] || { children: [] };
            const jobs = post.children;

            jobs.forEach(job => {
                // Search filter
                if (searchTerm && !job.text.toLowerCase().includes(searchTerm.toLowerCase())) {
                    return;
                }
                // Hide applied filter
                if (hideApplied && appliedJobs[job.objectID]) {
                    return;
                }

                const jobDiv = document.createElement('div');
                jobDiv.className = `p-3 border-l-4 ${appliedJobs[job.objectID] ? 'border-green-500 bg-green-50 dark:bg-green-900/30' : 'border-gray-200 bg-white dark:bg-gray-800'} rounded-r`;
                jobDiv.innerHTML = `
                    <p class="text-sm"><span class="hn-orange-text">${job.author}</span>: ${job.text}</p>
                    <div class="mt-2 flex space-x-2">
                        <button class="apply-btn px-3 py-1 ${appliedJobs[job.objectID] ? 'bg-gray-400' : 'bg-hn-orange'} text-white rounded text-sm" data-id="${job.objectID}">
                            ${appliedJobs[job.objectID] ? 'Applied' : 'Mark Applied'}
                        </button>
                    </div>
                    <textarea class="notes w-full p-2 mt-2 border rounded bg-white dark:bg-gray-800 text-sm" data-id="${job.objectID}" placeholder="Notes (e.g., Applied with resume v2)">${jobNotes[job.objectID]?.notes || ''}</textarea>
                    ${appliedJobs[job.objectID] ? `<p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Applied: ${new Date(appliedJobs[job.objectID].timestamp).toLocaleString()}</p>` : ''}
                `;
                jobList.appendChild(jobDiv);
            });

            // Event listeners
            document.querySelectorAll('.apply-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const jobId = btn.dataset.id;
                    if (!appliedJobs[jobId]) {
                        appliedJobs[jobId] = { applied: true, timestamp: Date.now() };
                        localStorage.setItem('hnAppliedJobs', JSON.stringify(appliedJobs));
                        renderJobs(month, document.getElementById('searchInput').value, document.getElementById('hideApplied').checked);
                    }
                });
            });

            document.querySelectorAll('.notes').forEach(textarea => {
                textarea.addEventListener('change', () => {
                    const jobId = textarea.dataset.id;
                    jobNotes[jobId] = { notes: textarea.value };
                    localStorage.setItem('hnJobNotes', JSON.stringify(jobNotes));
                });
            });
        }

        // Initialize
        let currentMonth = '2025-04';
        renderJobs(currentMonth);
        // initialize(); // Uncomment in production to fetch real data

        // Month switcher
        document.getElementById('monthSelect').addEventListener('change', (e) => {
            currentMonth = e.target.value;
            renderJobs(currentMonth, document.getElementById('searchInput').value, document.getElementById('hideApplied').checked);
        });

        // Search filter
        document.getElementById('searchInput').addEventListener('input', (e) => {
            renderJobs(currentMonth, e.target.value, document.getElementById('hideApplied').checked);
        });

        // Hide applied toggle
        document.getElementById('hideApplied').addEventListener('change', (e) => {
            renderJobs(currentMonth, document.getElementById('searchInput').value, e.target.checked);
        });

        // Dark mode toggle
        document.getElementById('darkModeToggle').addEventListener('click', () => {
            document.body.classList.toggle('dark');
            localStorage.setItem('hnDarkMode', document.body.classList.contains('dark'));
            document.getElementById('darkModeToggle').textContent = document.body.classList.contains('dark') ? 'Light Mode' : 'Dark Mode';
        });

        // Load dark mode preference
        if (localStorage.getItem('hnDarkMode') === 'true') {
            document.body.classList.add('dark');
            document.getElementById('darkModeToggle').textContent = 'Light Mode';
        }

        // Export data
        document.getElementById('exportBtn').addEventListener('click', () => {
            const data = { appliedJobs, jobNotes };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'hn_job_tracker.json';
            a.click();
            URL.revokeObjectURL(url);
        });

        // Import data
        document.getElementById('importBtn').addEventListener('click', () => {
            document.getElementById('importInput').click();
        });

        document.getElementById('importInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        appliedJobs = data.appliedJobs || {};
                        jobNotes = data.jobNotes || {};
                        localStorage.setItem('hnAppliedJobs', JSON.stringify(appliedJobs));
                        localStorage.setItem('hnJobNotes', JSON.stringify(jobNotes));
                        renderJobs(currentMonth, document.getElementById('searchInput').value, document.getElementById('hideApplied').checked);
                        alert('Data imported successfully!');
                    } catch (err) {
                        alert('Error importing data: Invalid JSON');
                    }
                };
                reader.readAsText(file);
            }
        });
    </script>
</body>
</html>